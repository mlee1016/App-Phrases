<div
  class="fixed inset-0 bg-gray-800/40 backdrop-blur-sm flex justify-center items-center z-50 px-4"
>
  <div
    class="bg-white dark:bg-gray-900 rounded-3xl shadow-2xl p-6 w-full max-w-sm sm:max-w-md md:max-w-lg text-center 
           animate-fadeInUp transition-all duration-300 max-h-[90vh] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-800"
  >
    <!-- ğŸ§© Try Again Popup -->
    <div *ngIf="showTryAgainPopup">
      <h2 class="text-3xl font-bold text-red-500 mb-3">Again ğŸ’ª</h2>
      <p class="text-gray-600 dark:text-gray-300 mb-6">
        Review your answers and give it another shot!
      </p>

      <button
        (click)="onNext()"
        class="w-full bg-gradient-to-r from-red-500 to-pink-500 hover:from-pink-500 hover:to-red-500 
               text-white font-semibold py-3 rounded-2xl shadow-lg transition-transform transform hover:scale-[1.03]"
      >
        Again
      </button>
    </div>

    <!-- ğŸ† Results Summary -->
    <div
      *ngIf="!showTryAgainPopup && userResults.length !== 0 && select === 'phrase'; else Oresult"
    >
      <h2 class="text-2xl font-bold text-cyan-600 dark:text-cyan-400 mt-4 mb-4">
        ğŸ¯ Your Results
      </h2>

      <div
        class="text-gray-700 dark:text-gray-300 mb-4 bg-gray-50 dark:bg-gray-800 rounded-2xl p-3 shadow-inner"
      >
        <p>âœ… <strong>{{ correctCount }}</strong> Correct</p>
        <p>âŒ <strong>{{ wrongCount }}</strong> Wrong</p>
      </div>

      <!-- ğŸ§¾ Display user answers -->
      <div
        class="max-h-64 overflow-y-auto border-t border-gray-200 dark:border-gray-700 pt-3 space-y-2 text-left 
               scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-800"
      >
        <div
          *ngFor="let ca of userResults"
          class="p-3 rounded-xl shadow-sm transition-all duration-200"
          [ngClass]="
            ca.correct
              ? 'bg-green-50 dark:bg-green-900/40 text-green-700 dark:text-green-300'
              : 'bg-red-50 dark:bg-red-900/40 text-red-600 dark:text-red-300'
          "
        >
          <div class="font-semibold">{{ ca.phrase[la] }}</div>
          <div class="text-sm text-gray-500 dark:text-gray-400">
            {{ ca.phrase[pr] }}
          </div>
          <div class="text-sm italic text-gray-600 dark:text-gray-300">
            {{ ca.phrase.en }}
          </div>
          <div class="mt-1 text-right font-bold">
            {{ ca.correct ? 'âœ”ï¸ Correct' : 'âœ–ï¸ Wrong' }}
          </div>
        </div>
      </div>

      <button
        (click)="onRetry()"
        class="w-full mt-5 bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-blue-500 hover:to-cyan-500 
               text-white font-semibold py-3 rounded-2xl shadow-lg transition-transform transform hover:scale-[1.03]"
      >
        Continue âœ
      </button>
    </div>

    <!-- ğŸ¯ Alternate Result Views -->
    <ng-template #Oresult>
      <div
        *ngIf="['s', 'type', 'speech'].includes(select)"
        class="bg-gray-900 text-white p-6 rounded-xl shadow-xl w-full mx-auto 
               max-h-[70vh] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-800"
      >
        <h2 class="text-xl font-bold mb-4 sticky top-0 bg-gray-900 z-10">Results ğŸ¯</h2>
        <div
          *ngFor="let r of userResults"
          class="border-b border-gray-700 py-2 flex justify-between items-center text-sm sm:text-base"
        >
          <span [innerHTML]="formatPhrase(r.phrase)" class="pr-2 flex-1"></span>
          <span [ngClass]="r.correct ? 'text-green-400' : 'text-red-400'">
            {{ r.correct ? 'âœ…' : 'âŒ' }}
            ({{ r.attempts }} attempt{{ r.attempts > 1 ? 's' : '' }})
          </span>
        </div>
      </div>
       
      <div
        *ngIf="['choice'].includes(select)"
        class="bg-gray-900 text-white p-6 rounded-xl shadow-xl w-full mx-auto 
               max-h-[70vh] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-800"
      >
        <!--<h2 class="text-xl font-bold mb-4 sticky top-0 bg-gray-900 z-10">Results ğŸ¯</h2>
        <div
          *ngFor="let r of userResults"
          class="border-b border-gray-700 py-2 flex justify-between items-center text-sm sm:text-base"
        >
          <span [innerHTML]="formatPhrase(r.phrase)" class="pr-2 flex-1"></span>
          <span [ngClass]="r.correct ? 'text-green-400' : 'text-red-400'">
            {{ r.correct ? 'âœ…' : 'âŒ' }}
            ({{ r.attempts }} attempt{{ r.attempts > 1 ?  's' : '' }})
          </span>
        </div>-->
      <h2 class="text-2xl font-bold text-cyan-600 dark:text-cyan-400 mt-4 mb-4">
        ğŸ¯ Results:
      </h2> 
      <div class="text-cyan-200 mt-5 mb-4 ">correct: {{correctCount}} wrong: {{wrongCount}}
         score: {{(correctCount/(correctCount+wrongCount))*100 | number:'1.0-0'}}%
      
      </div>
      <div *ngFor="let item of userResults" class="mb-2 p-3 rounded-xl shadow-sm"
            [ngClass]="item.correct ? 'bg-green-50 dark:bg-green-900/40 text-green-700 dark:text-green-300' : 'bg-red-50 dark:bg-red-900/40 text-red-600 dark:text-red-300'">
        <p>{{ item.phrase.phrase }} <br>{{item.phrase.pr}} <br> {{item.phrase.en}} <br> {{ item.correct ? 'âœ”ï¸' : 'âŒ' }}</p>
      </div>
      


      <button
        (click)="onNext()"
        class="w-full bg-gradient-to-r from-red-500 to-pink-500 hover:from-pink-500 hover:to-red-500 
               text-white font-semibold py-3 rounded-2xl shadow-lg transition-transform transform hover:scale-[1.03]"
      >
        Again
      </button>
      <button
        (click)="onRetry()"
        class="w-full mt-5 bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-blue-500 hover:to-cyan-500 
               text-white font-semibold py-3 rounded-2xl shadow-lg transition-transform transform hover:scale-[1.03]"
      >
        Continue âœ
      </button>
      </div>
    </ng-template>
  </div>
</div>
