<!-- ğŸ“Œ Current Phrase --
<h2 class="text-2xl font-semibold mb-4 ml-4 text-cyan-200">
  {{ selectedPhrases() === '' ? 'ğŸ“– Pick a phrase' : 'ğŸ“˜ Currently studying: ' + selectedPhrases() }}
</h2>-->
<header class="flex justify-between items-center p-4 bg-[#0F1F26] shadow-md text-cyan-100">
  <h2 class="text-lg md:text-xl font-bold">
    {{ selectedPhrases() === '' ? 'ğŸ“š Pick a list â†’' : 'Currently studying: ' + selectedPhrases() }}
  </h2>
  <button

    (click)="open()"
    class="bg-cyan-500 hover:bg-cyan-400 text-black px-3 py-2 rounded-lg shadow transition"
  >
    {{ sideBar ? 'âœ– Close' : 'â˜° Menu' }}
  </button>
</header>
<!-- ğŸ”¹ Sidebar Backdrop -->
<div *ngIf="sideBar" class="fixed inset-0 bg-black bg-opacity-70 z-40 flex items-center justify-center">
  <!-- Modal Panel -->
  <div class="bg-gradient-to-br from-cyan-950 to-cyan-900 text-white w-[90%] max-w-lg rounded-2xl shadow-2xl p-6 space-y-6 z-50 animate-fadeInUp">
    
    <!-- Close Button -->
    <div class="text-right">
      <button
        class="text-sm bg-cyan-800 hover:bg-cyan-700 px-3 py-1 rounded-full shadow transition"
        (click)="close()"
      >
        âœ– Close
      </button>
    </div>

    <!-- Sidebar Content -->
    <div>
      <h2 class="text-lg font-bold mb-2 text-cyan-300">
        {{ selectedPhrases() === '' ? 'Select a phrase' : 'Selected: ' + selectedPhrases() }}
      </h2>
      <h3 class="text-md font-semibold mb-2 border-b border-cyan-600 pb-1">ğŸ“š Course</h3>
      <div class="flex flex-col gap-2 max-h-[15rem] overflow-y-auto pr-2">
        <button
          *ngFor="let item of phraseStory"
          (click)="getSpecificPhrases(item.s)"
          class="px-3 py-2 rounded-lg transition shadow "
          [ngClass]="item.isDone ? 'bg-emerald-600 hover:bg-emerald-500' : 'bg-cyan-600 hover:bg-cyan-500'"
        >
          {{ item.s }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ğŸ”¹ Open Sidebar Button --
<button
  class="px-6 py-2 m-[1.8rem] fixed rounded-lg bg-cyan-400 hover:bg-cyan-500 text-cyan-900 font-semibold shadow-md transition"
  (click)="open()"
>
  ğŸ“‚ Open
</button>-->

<!-- ğŸ”¹ Start Quiz -->
<div *ngIf="isReadyToStart && !quizStarted" class="text-center mt-10">
  <button (click)="startQuiz()"
          class="bg-emerald-600 hover:bg-emerald-700 text-white px-8 py-3 rounded-lg shadow-lg text-lg font-semibold transition hover:scale-105">
    â–¶ Start 
  </button>
</div>

<!-- ğŸ”¹ Quiz Container -->
<div *ngIf="quizStarted" class="max-w-xl mx-auto mt-12 px-6 py-8 rounded-2xl shadow-xl bg-cyan-950 border border-cyan-600">

  <ng-container *ngIf="!quizComplete; else results">
    <!-- Question -->
    <p class="text-xl font-bold text-cyan-100 mb-3 text-center" [innerHTML]="formatEnglish(currentQuestion.en)"></p>

    <p class="text-lg font-mono text-gray-200 mb-2 text-center">
      {{ currentQuestion[initial].replace('___', '___') }}
    </p>

    <p *ngIf="pro" class="text-sm italic text-gray-400 mb-6 text-center">
      {{ currentQuestion.pr }}
    </p>

    <!-- Options -->
    <div class="space-y-3 mb-6">
      <button
        *ngFor="let option of shuffledOptions; let i = index"
        (click)="selectAnswer4(i)"
        [disabled]="selectedIndex !== null"
        class="w-full px-5 py-3 border rounded-lg text-left transition duration-200 font-medium shadow-sm"
        [ngClass]="{
          'bg-green-100 border-green-500 text-green-800 correct-a': answerChecked && sub && selectedIndex === i,
          'bg-red-100 border-red-500 text-red-800 wrong': answerChecked && !sub && selectedIndex === i,
          'bg-cyan-100 border-cyan-400 text-cyan-700': selectedIndex === i && !answerChecked,
          'hover:bg-cyan-600 hover:text-white': selectedIndex === null
        }"
      >
        {{ option[initial] }}
        <span *ngIf="pro" class="text-sm text-indigo-400 hover:text-indigo-800 ml-2">({{ option.pr }})</span>
      </button>
    </div>
    <div *ngIf="answerChecked && !sub" class="mt-4 p-3 rounded-lg bg-emerald-900/30 border border-emerald-600 text-emerald-300 text-center">
      âœ… Correct Answer: 
      <span class="font-bold text-white">{{ currentQuestion.answer[0][initial] }}{{currentQuestion.answer[1]?','+currentQuestion.answer[1][initial]:''}}</span>
      <span *ngIf="pro" class="italic text-sm text-gray-300 ml-2">
        ({{ currentQuestion.answer[0].pr }}){{currentQuestion.answer[1]?',('+currentQuestion.answer[1].pr+')':''}}
      </span>
    </div>
    <!-- Controls -->
    <div class="flex flex-wrap justify-center gap-4 mt-6">
      <p class="text-sm text-gray-300 self-center">â­ Score: {{ score }} / {{ phrases().length }}</p>
      <button *ngIf="answerChecked2"
              (click)="nextQuestion()"
              class="bg-cyan-600 hover:bg-cyan-700 text-white px-5 py-2 rounded-lg shadow transition hover:scale-105">
        â¡ Next
      </button>
      <button (click)="togglePr()" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg shadow transition">
        ğŸ”¤ Pronunciation
      </button>
      <button *ngIf="answerChecked2"
              (click)="playSpeechForQuestion(currentQuestion)"
              class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg shadow transition">
        ğŸ”Š Play
      </button>
    </div>
  </ng-container>

  <!-- Results -->
  <ng-template #results>
    <div class="text-center space-y-4">
      <h2 class="text-3xl font-bold text-emerald-400">ğŸ‰ Quiz Complete!</h2>
      <p class="text-lg text-gray-200">Final Score: <span class="font-bold text-cyan-400">{{ score }}</span> / {{ phrases().length }}</p>
      <button
        (click)="againQuiz()"
        class="bg-emerald-600 hover:bg-emerald-700 text-white px-8 py-3 rounded-lg shadow-lg font-semibold transition hover:scale-105"
      >
        ğŸ” Try Again
      </button>
    </div>
  </ng-template>
</div>
