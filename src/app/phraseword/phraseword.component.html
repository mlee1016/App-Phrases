<!-- ğŸ“± HEADER -->
<header class="flex justify-between items-center px-4 py-3 bg-[#0F1F26] shadow-md text-cyan-100 sticky top-0 z-30">
  <h2 class="text-base sm:text-lg font-bold truncate max-w-[70%]">
    {{ selectedPhrases() === '' ? 'ğŸ“š Pick a list â†’' : 'Studying: ' + selectedPhrases() }}
  </h2>
  <button
    (click)="open()"
    class="bg-cyan-500 hover:bg-cyan-400 text-black px-3 py-1.5 rounded-lg shadow text-sm sm:text-base transition"
  >
    {{ sideBar ? 'âœ–' : 'â˜°' }}
  </button>
</header>

<!-- ğŸ“‚ SIDE-->
<div *ngIf="sideBar" class="fixed inset-0 bg-black bg-opacity-70 z-40 flex items-center justify-center">
  <div
    class="bg-gradient-to-br from-cyan-950 to-cyan-900 text-white w-[90%] sm:w-[400px] rounded-2xl shadow-2xl p-5 space-y-5 z-50 animate-fadeInUp overflow-y-auto max-h-[80vh]"
  >
    <!-- Close -->
    <div class="text-right">
      <button
        class="text-xs sm:text-sm bg-cyan-800 hover:bg-cyan-700 px-3 py-1 rounded-full shadow transition"
        (click)="close()"
      >
        âœ– Close
      </button>
    </div>

    <!-- Sidebar Content -->
    <div>
      <h2 class="text-lg font-bold mb-3 text-cyan-300 text-center">
        {{ selectedPhrases() === '' ? 'Select a phrase' : 'Selected: ' + selectedPhrases() }}
      </h2>

      <h3 class="text-md font-semibold mb-2 border-b border-cyan-600 pb-1 text-cyan-200">ğŸ“š Course</h3>

      <div class="flex flex-col gap-2 max-h-[15rem] overflow-y-auto pr-1">
        <button
          *ngFor="let item of phraseStory"
          (click)="getSpecificPhrases(item.s)"
          class="px-3 py-2 rounded-lg transition text-sm sm:text-base shadow"
          [ngClass]="item.isDone ? 'bg-emerald-600 hover:bg-emerald-500' : 'bg-cyan-600 hover:bg-cyan-500'"
        >
          {{ item.s }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- â–¶ START QUIZ -->
<div *ngIf="isReadyToStart && !quizStarted" class="text-center mt-10">
  <button
    (click)="startQuiz()"
    class="bg-emerald-600 hover:bg-emerald-700 text-white px-8 py-3 rounded-lg shadow-lg text-lg font-semibold transition hover:scale-105"
  >
    â–¶ Start
  </button>
</div>

<!-- ğŸ§  QUIZ -->
<div *ngIf="quizStarted" class="max-w-xl mx-auto mt-8 sm:mt-12 px-4 sm:px-6 py-6 sm:py-8 rounded-2xl shadow-xl bg-cyan-950 border border-cyan-600">

  <ng-container *ngIf="!quizComplete; else results">
    <!-- Question -->
    <p class="text-lg sm:text-xl font-bold text-cyan-100 mb-3 text-center" [innerHTML]="formatEnglish(currentQuestion.en)"></p>

    <p class="text-base sm:text-lg font-mono text-gray-200 mb-2 text-center break-words">
      {{ currentQuestion[initial].replace('___', '___') }}
    </p>

    <p *ngIf="pro" class="text-sm italic text-gray-400 mb-6 text-center">
      {{ currentQuestion.pr }}
    </p>

    <!-- Options -->
    <div class="space-y-3 mb-6">
      <button
        *ngFor="let option of shuffledOptions; let i = index"
        (click)="selectAnswer4(i)"
        [disabled]="selectedIndex !== null"
        class="w-full px-4 py-2 sm:py-3 border rounded-lg text-left transition text-sm sm:text-base font-medium shadow-sm"
        [ngClass]="{
          'bg-green-100 border-green-500 text-green-800 correct-a': answerChecked && sub && selectedIndex === i,
          'bg-red-100 border-red-500 text-red-800 wrong': answerChecked && !sub && selectedIndex === i,
          'bg-cyan-100 border-cyan-400 text-cyan-700': selectedIndex === i && !answerChecked,
          'hover:bg-cyan-600 hover:text-white': selectedIndex === null
        }"
      >
        {{ option[initial] }}
        <span *ngIf="pro" class="text-xs sm:text-sm text-indigo-400 ml-2">({{ option.pr }})</span>
      </button>
    </div>

    <!-- Correct Answer -->
    <div *ngIf="answerChecked && !sub" class="mt-4 p-3 rounded-lg bg-emerald-900/30 border border-emerald-600 text-emerald-300 text-center text-sm sm:text-base">
      âœ… Correct: 
      <span class="font-bold text-white">{{ currentQuestion.answer[0][initial] }}{{ currentQuestion.answer[1] ? ',' + currentQuestion.answer[1][initial] : '' }}</span>
      <span *ngIf="pro" class="italic text-gray-300 ml-2 text-xs sm:text-sm">
        ({{ currentQuestion.answer[0].pr }}){{ currentQuestion.answer[1] ? ', (' + currentQuestion.answer[1].pr + ')' : '' }}
      </span>
    </div>

    <!-- Controls -->
    <div class="flex flex-wrap justify-center gap-3 sm:gap-4 mt-6">
      <p class="text-xs sm:text-sm text-gray-300 self-center">â­ {{ score }} / {{ phrases().length }}</p>
      <button *ngIf="answerChecked2"
              (click)="nextQuestion()"
              class="bg-cyan-600 hover:bg-cyan-700 text-white px-4 sm:px-5 py-2 rounded-lg shadow transition text-sm sm:text-base">
        â¡ Next
      </button>
      <button (click)="togglePr()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow transition text-sm sm:text-base">
        ğŸ”¤ Pronunciation
      </button>
      <button *ngIf="answerChecked2"
              (click)="playSpeechForQuestion(currentQuestion)"
              class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg shadow transition text-sm sm:text-base">
        ğŸ”Š Play
      </button>
    </div>
  </ng-container>

  <!-- ğŸ¯ Results -->
  <ng-template #results>
    <div class="text-center space-y-4">
      <h2 class="text-2xl sm:text-3xl font-bold text-emerald-400">ğŸ‰ Quiz Complete!</h2>
      <p class="text-base sm:text-lg text-gray-200">Final Score: <span class="font-bold text-cyan-400">{{ score }}</span> / {{ phrases().length }}</p>
      <button
        (click)="againQuiz()"
        class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 sm:px-8 py-2.5 sm:py-3 rounded-lg shadow-lg font-semibold transition hover:scale-105 text-sm sm:text-base"
      >
        ğŸ” Try Again
      </button>
    </div>
  </ng-template>
</div>
